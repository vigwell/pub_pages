<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专 砖 Paging -Web API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', 'Tahoma', sans-serif;
            line-height: 1.8;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
        }

        h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h3 {
            color: #34495e;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h4 {
            color: #34495e;
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-right: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            font-size: 0.9em;
            direction: ltr;
            display: inline-block;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            border-right: 4px solid #3498db;
            direction: ltr;
            text-align: left;
        }

        pre code {
            background: none;
            color: #ecf0f1;
            padding: 0;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .toc {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 30px 0;
        }

        .toc h2 {
            margin-top: 0;
            border-bottom: none;
            font-size: 1.5em;
        }

        .toc ul {
            list-style: none;
            margin-right: 0;
        }

        .toc li {
            margin-bottom: 5px;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s;
        }

        .toc a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        .note {
            background: #fff3cd;
            border-right: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 3px;
        }

        .warning {
            background: #f8d7da;
            border-right: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 3px;
        }

        .tip {
            background: #d4edda;
            border-right: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .highlight {
            background: #ffffcc;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .section {
            margin-bottom: 40px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            background: #3498db;
            color: white;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 10px;
        }

        .badge.green {
            background: #28a745;
        }

        .badge.red {
            background: #dc3545;
        }

        .badge.yellow {
            background: #ffc107;
            color: #333;
        }

        strong {
            color: #2c3e50;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }
            
            pre {
                page-break-inside: avoid;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            h2 {
                font-size: 1.6em;
            }
            
            pre {
                padding: 10px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>专 砖 Paging -Web API 驻转</h1>
        <p><strong>专住:</strong> 1.0 | <strong>注 专:</strong> 专 2026</p>

        <div class="toc">
            <h2>转 注</h2>
            <ul>
                <li><a href="#introduction">1. </a></li>
                <li><a href="#core-concepts">2. 砖 住</a></li>
                <li><a href="#api-design">3. 住专 注爪 API</a></li>
                <li><a href="#implementation">4. 转 砖</a></li>
                <li><a href="#database">5. 砖 住驻爪驻 住 转</a></li>
                <li><a href="#advanced">6. 转专砖 转拽</a></li>
                <li><a href="#best-practices">7. 砖转 注 爪转</a></li>
                <li><a href="#pitfalls">8. 转 驻爪转</a></li>
                <li><a href="#summary">9. 住</a></li>
            </ul>
        </div>

        <div id="introduction" class="section">
            <h2>1. </h2>
            <p>住  住驻拽 专 拽祝 砖 Pagination (注) -RESTful Web APIs 爪注转 C# -ASP.NET Core. Pagination  注专:</p>
            <ul>
                <li><strong>爪注:</strong> 驻转转 注专转 转  注</li>
                <li><strong>转 砖转砖:</strong> 注转 转 驻 专转</li>
                <li><strong> 砖:</strong>  注 砖 专 专 住 转</li>
                <li><strong>专转:</strong> 转 注专 转   注住 注 注专转</li>
            </ul>
        </div>

        <div id="core-concepts" class="section">
            <h2>2. 砖 住</h2>
            
            <h3> Paging?</h3>
            <p>Paging ( Pagination)  转 砖 拽转 注专 转  驻 拽 驻专 砖转 专 驻 注爪.</p>

            <h3>专 专转</h3>
            <ul>
                <li><strong>住驻专 祝 (Page Number):</strong> 祝  拽砖 (抓 拽住 住住-1)</li>
                <li><strong> 祝 (Page Size):</strong> 住驻专 驻专  祝</li>
                <li><strong>住驻专 转 (Total Count):</strong> 住驻专  驻专 注专 转</li>
                <li><strong>住 驻 (Total Pages):</strong> 砖 -<code>Ceiling(TotalCount / PageSize)</code></li>
                <li><strong>住 (Offset):</strong> 拽 转 注专 转, 砖 -<code>(PageNumber - 1) * PageSize</code></li>
            </ul>

            <h3>住专转 Paging</h3>
            <ol>
                <li><strong>Offset-Based Paging:</strong> 砖转砖 住驻专 祝  祝 (驻抓 转专)</li>
                <li><strong>Cursor-Based Paging:</strong> 砖转砖 -cursor/token 专 住  ( 转专 转  转)</li>
                <li><strong>Keyset Paging:</strong> 砖转砖 驻转 专 砖专 砖转  (注 转专 注专 转 )</li>
            </ol>
        </div>

        <div id="api-design" class="section">
            <h2>3. 住专 注爪 API</h2>

            <h3>驻专专 拽砖 (Request Parameters)</h3>

            <h4>驻专专 砖转 住专</h4>
            <pre><code>public class PagingParameters
{
    private const int MaxPageSize = 100;
    private int _pageSize = 10;
    
    /// &lt;summary&gt;
    /// 住驻专 祝 (住住-1)
    /// &lt;/summary&gt;
    public int PageNumber { get; set; } = 1;
    
    /// &lt;summary&gt;
    /// 住驻专 驻专 祝
    /// &lt;/summary&gt;
    public int PageSize
    {
        get => _pageSize;
        set => _pageSize = value > MaxPageSize ? MaxPageSize : value;
    }
}</code></pre>

            <h4>驻专专 专 注 住 </h4>
            <pre><code>public class ProductQueryParameters : PagingParameters
{
    /// &lt;summary&gt;
    ///  驻砖 砖 爪专
    /// &lt;/summary&gt;
    public string SearchTerm { get; set; }
    
    /// &lt;summary&gt;
    /// 住 驻 拽专
    /// &lt;/summary&gt;
    public string Category { get; set; }
    
    /// &lt;summary&gt;
    /// 住 专 
    /// &lt;/summary&gt;
    public decimal? MinPrice { get; set; }
    
    /// &lt;summary&gt;
    /// 住 专 拽住
    /// &lt;/summary&gt;
    public decimal? MaxPrice { get; set; }
    
    /// &lt;summary&gt;
    /// 砖  (: "name", "price", "createdDate")
    /// &lt;/summary&gt;
    public string SortBy { get; set; } = "name";
    
    /// &lt;summary&gt;
    ///  : "asc"  "desc"
    /// &lt;/summary&gt;
    public string SortDirection { get; set; } = "asc";
}</code></pre>

            <h3> 转 (Response Structure)</h3>

            <h4>转 注转 住专转</h4>
            <pre><code>public class PagedResponse&lt;T&gt;
{
    /// &lt;summary&gt;
    /// 住驻专 祝 
    /// &lt;/summary&gt;
    public int PageNumber { get; set; }
    
    /// &lt;summary&gt;
    /// 住驻专 驻专 祝
    /// &lt;/summary&gt;
    public int PageSize { get; set; }
    
    /// &lt;summary&gt;
    /// 住驻专  砖 驻专  驻
    /// &lt;/summary&gt;
    public int TotalCount { get; set; }
    
    /// &lt;summary&gt;
    /// 住驻专  砖 驻
    /// &lt;/summary&gt;
    public int TotalPages { get; set; }
    
    /// &lt;summary&gt;
    /// 爪  拽 祝 拽
    /// &lt;/summary&gt;
    public bool HasPrevious { get; set; }
    
    /// &lt;summary&gt;
    /// 爪  拽 祝 
    /// &lt;/summary&gt;
    public bool HasNext { get; set; }
    
    /// &lt;summary&gt;
    /// 驻专 转 驻注 祝 
    /// &lt;/summary&gt;
    public IEnumerable&lt;T&gt; Data { get; set; }
    
    public PagedResponse(IEnumerable&lt;T&gt; data, int pageNumber, int pageSize, int totalCount)
    {
        Data = data;
        PageNumber = pageNumber;
        PageSize = pageSize;
        TotalCount = totalCount;
        TotalPages = (int)Math.Ceiling(totalCount / (double)pageSize);
        HasPrevious = pageNumber > 1;
        HasNext = pageNumber < TotalPages;
    }
}</code></pre>

            <div class="tip">
                <strong> 驻:</strong> 转  -  <code>TotalCount</code>, <code>TotalPages</code>, <code>HasPrevious</code> -<code>HasNext</code> 转 砖.  注专 拽转 转 砖拽 Pagination   爪专 拽砖转 住驻转.
            </div>
        </div>

        <div id="implementation" class="section">
            <h2>4. 转 砖</h2>

            <h3>砖 Controller</h3>

            <h4>Controller 住住 注 Paging</h4>
            <pre><code>[ApiController]
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    private readonly IProductService _productService;
    private readonly ILogger&lt;ProductsController&gt; _logger;
    
    public ProductsController(IProductService productService, ILogger&lt;ProductsController&gt; logger)
    {
        _productService = productService;
        _logger = logger;
    }
    
    /// &lt;summary&gt;
    /// 拽转 专砖转 爪专 注转
    /// &lt;/summary&gt;
    /// &lt;param name="parameters"&gt;驻专专 砖转  住驻专 祝 &lt;/param&gt;
    /// &lt;returns&gt;专砖转 爪专 注转&lt;/returns&gt;
    [HttpGet]
    [ProducesResponseType(typeof(PagedResponse&lt;ProductDto&gt;), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task&lt;ActionResult&lt;PagedResponse&lt;ProductDto&gt;&gt;&gt; GetProducts(
        [FromQuery] PagingParameters parameters)
    {
        try
        {
            if (parameters.PageNumber < 1)
                return BadRequest("住驻专 祝  转  -0");
            
            if (parameters.PageSize < 1)
                return BadRequest(" 祝  转  -0");
            
            var result = await _productService.GetProductsAsync(parameters);
            return Ok(result);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 专 爪专");
            return StatusCode(500, "专注 砖 专 爪专");
        }
    }
}</code></pre>

            <h4>Controller 转拽 注 住</h4>
            <pre><code>[ApiController]
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    private readonly IProductService _productService;
    private readonly ILogger&lt;ProductsController&gt; _logger;
    
    public ProductsController(IProductService productService, ILogger&lt;ProductsController&gt; logger)
    {
        _productService = productService;
        _logger = logger;
    }
    
    /// &lt;summary&gt;
    /// 拽转 专砖转 爪专 注转 住转
    /// &lt;/summary&gt;
    /// &lt;param name="parameters"&gt;驻专专 砖转  住,  注&lt;/param&gt;
    /// &lt;returns&gt;专砖转 爪专 注转&lt;/returns&gt;
    [HttpGet]
    [ProducesResponseType(typeof(PagedResponse&lt;ProductDto&gt;), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task&lt;ActionResult&lt;PagedResponse&lt;ProductDto&gt;&gt;&gt; GetProducts(
        [FromQuery] ProductQueryParameters parameters)
    {
        try
        {
            // 转 驻专专
            if (parameters.PageNumber < 1)
                return BadRequest("住驻专 祝  转  -0");
            
            if (parameters.PageSize < 1)
                return BadRequest(" 祝  转  -0");
            
            if (parameters.MinPrice.HasValue && parameters.MaxPrice.HasValue 
                && parameters.MinPrice > parameters.MaxPrice)
                return BadRequest("专    转  专 拽住");
            
            var result = await _productService.GetProductsAsync(parameters);
            
            // 住驻转 - 砖 pagination 转专转 转
            Response.Headers.Add("X-Pagination", 
                System.Text.Json.JsonSerializer.Serialize(new
                {
                    result.PageNumber,
                    result.PageSize,
                    result.TotalCount,
                    result.TotalPages
                }));
            
            return Ok(result);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 专 爪专 注 住: {@Parameters}", parameters);
            return StatusCode(500, "专注 砖 专 爪专");
        }
    }
}</code></pre>

            <h3>砖 砖转 Service</h3>
            <pre><code>public interface IProductService
{
    Task&lt;PagedResponse&lt;ProductDto&gt;&gt; GetProductsAsync(ProductQueryParameters parameters);
    Task&lt;ProductDto&gt; GetProductByIdAsync(int id);
}

public class ProductService : IProductService
{
    private readonly IProductRepository _repository;
    private readonly IMapper _mapper;
    private readonly ILogger&lt;ProductService&gt; _logger;
    
    public ProductService(
        IProductRepository repository, 
        IMapper mapper,
        ILogger&lt;ProductService&gt; logger)
    {
        _repository = repository;
        _mapper = mapper;
        _logger = logger;
    }
    
    public async Task&lt;PagedResponse&lt;ProductDto&gt;&gt; GetProductsAsync(ProductQueryParameters parameters)
    {
        try
        {
            // 拽转 转 注 -repository
            var (products, totalCount) = await _repository.GetProductsPagedAsync(parameters);
            
            // 专 -DTOs
            var productDtos = _mapper.Map&lt;IEnumerable&lt;ProductDto&gt;&gt;(products);
            
            // 爪专 专转 转 注转
            return new PagedResponse&lt;ProductDto&gt;(
                productDtos,
                parameters.PageNumber,
                parameters.PageSize,
                totalCount
            );
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 -GetProductsAsync 注 驻专专: {@Parameters}", parameters);
            throw;
        }
    }
    
    public async Task&lt;ProductDto&gt; GetProductByIdAsync(int id)
    {
        var product = await _repository.GetByIdAsync(id);
        return _mapper.Map&lt;ProductDto&gt;(product);
    }
}</code></pre>

            <h3>砖 Repository</h3>

            <h4>砖 Entity Framework</h4>
            <pre><code>public class ProductRepository : IProductRepository
{
    private readonly ApplicationDbContext _context;
    private readonly ILogger&lt;ProductRepository&gt; _logger;
    
    public ProductRepository(ApplicationDbContext context, ILogger&lt;ProductRepository&gt; logger)
    {
        _context = context;
        _logger = logger;
    }
    
    public async Task&lt;(IEnumerable&lt;Product&gt; Products, int TotalCount)&gt; GetProductsPagedAsync(
        ProductQueryParameters parameters)
    {
        try
        {
            // 转 注 砖转转 住住
            IQueryable&lt;Product&gt; query = _context.Products.AsNoTracking();
            
            // 转 住
            query = ApplyFilters(query, parameters);
            
            // 拽转 住驻专 转 驻 注
            var totalCount = await query.CountAsync();
            
            // 转 
            query = ApplySorting(query, parameters.SortBy, parameters.SortDirection);
            
            // 转 注
            var products = await query
                .Skip((parameters.PageNumber - 1) * parameters.PageSize)
                .Take(parameters.PageSize)
                .ToListAsync();
            
            return (products, totalCount);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 -GetProductsPagedAsync");
            throw;
        }
    }
    
    private IQueryable&lt;Product&gt; ApplyFilters(IQueryable&lt;Product&gt; query, ProductQueryParameters parameters)
    {
        // 住  驻砖
        if (!string.IsNullOrWhiteSpace(parameters.SearchTerm))
        {
            var searchTerm = parameters.SearchTerm.ToLower();
            query = query.Where(p => p.Name.ToLower().Contains(searchTerm) 
                                  || p.Description.ToLower().Contains(searchTerm));
        }
        
        // 住 拽专
        if (!string.IsNullOrWhiteSpace(parameters.Category))
        {
            query = query.Where(p => p.Category == parameters.Category);
        }
        
        // 住  专
        if (parameters.MinPrice.HasValue)
        {
            query = query.Where(p => p.Price >= parameters.MinPrice.Value);
        }
        
        if (parameters.MaxPrice.HasValue)
        {
            query = query.Where(p => p.Price <= parameters.MaxPrice.Value);
        }
        
        return query;
    }
    
    private IQueryable&lt;Product&gt; ApplySorting(
        IQueryable&lt;Product&gt; query, 
        string sortBy, 
        string sortDirection)
    {
        var isAscending = sortDirection?.ToLower() == "asc";
        
        query = sortBy?.ToLower() switch
        {
            "name" => isAscending 
                ? query.OrderBy(p => p.Name) 
                : query.OrderByDescending(p => p.Name),
            "price" => isAscending 
                ? query.OrderBy(p => p.Price) 
                : query.OrderByDescending(p => p.Price),
            "createdate" => isAscending 
                ? query.OrderBy(p => p.CreatedDate) 
                : query.OrderByDescending(p => p.CreatedDate),
            "category" => isAscending 
                ? query.OrderBy(p => p.Category) 
                : query.OrderByDescending(p => p.Category),
            _ => query.OrderBy(p => p.Name) //  专专转 
        };
        
        return query;
    }
}</code></pre>

            <div class="warning">
                <strong>锔 专:</strong> 转 砖转砖 -<code>AsNoTracking()</code> 注专 砖转转 拽专 .  砖驻专 砖注转转 转 爪注 注  注转 Entity Framework 注拽 专 砖 砖转.
            </div>
        </div>

        <div id="database" class="section">
            <h2>5. 砖 住驻爪驻 住 转</h2>

            <h3>SQL Server Stored Procedure</h3>

            <h4>爪专转 Stored Procedure</h4>
            <pre><code>CREATE PROCEDURE sp_GetProductsPaged
    @PageNumber INT = 1,
    @PageSize INT = 10,
    @SearchTerm NVARCHAR(100) = NULL,
    @Category NVARCHAR(50) = NULL,
    @MinPrice DECIMAL(18, 2) = NULL,
    @MaxPrice DECIMAL(18, 2) = NULL,
    @SortBy NVARCHAR(50) = 'Name',
    @SortDirection NVARCHAR(4) = 'ASC',
    @TotalCount INT OUTPUT
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @Offset INT = (@PageNumber - 1) * @PageSize;
    
    -- 转 WHERE clause
    DECLARE @WhereClause NVARCHAR(MAX) = 'WHERE 1=1';
    
    IF @SearchTerm IS NOT NULL
        SET @WhereClause = @WhereClause + 
            ' AND (Name LIKE ''%' + @SearchTerm + '%'' OR Description LIKE ''%' + @SearchTerm + '%'')';
    
    IF @Category IS NOT NULL
        SET @WhereClause = @WhereClause + ' AND Category = ''' + @Category + '''';
    
    IF @MinPrice IS NOT NULL
        SET @WhereClause = @WhereClause + ' AND Price >= ' + CAST(@MinPrice AS NVARCHAR(20));
    
    IF @MaxPrice IS NOT NULL
        SET @WhereClause = @WhereClause + ' AND Price <= ' + CAST(@MaxPrice AS NVARCHAR(20));
    
    -- 拽转 住驻专 转
    DECLARE @CountSQL NVARCHAR(MAX) = 
        'SELECT @Total = COUNT(*) FROM Products ' + @WhereClause;
    
    EXEC sp_executesql @CountSQL, N'@Total INT OUTPUT', @Total = @TotalCount OUTPUT;
    
    -- 转 注转  注转 SQL injection
    IF @SortBy NOT IN ('Name', 'Price', 'CreatedDate', 'Category')
        SET @SortBy = 'Name';
    
    IF @SortDirection NOT IN ('ASC', 'DESC')
        SET @SortDirection = 'ASC';
    
    -- 拽转 转 注
    DECLARE @SQL NVARCHAR(MAX) = 
        'SELECT 
            Id,
            Name,
            Description,
            Price,
            Category,
            CreatedDate,
            ModifiedDate
        FROM Products ' + @WhereClause +
        ' ORDER BY ' + @SortBy + ' ' + @SortDirection +
        ' OFFSET @Offset ROWS FETCH NEXT @PageSize ROWS ONLY';
    
    EXEC sp_executesql @SQL, 
        N'@Offset INT, @PageSize INT', 
        @Offset = @Offset, 
        @PageSize = @PageSize;
END
GO</code></pre>

            <h4>砖 Repository 注 Stored Procedure</h4>
            <pre><code>public class ProductRepository : IProductRepository
{
    private readonly string _connectionString;
    private readonly ILogger&lt;ProductRepository&gt; _logger;
    
    public ProductRepository(IConfiguration configuration, ILogger&lt;ProductRepository&gt; logger)
    {
        _connectionString = configuration.GetConnectionString("DefaultConnection");
        _logger = logger;
    }
    
    public async Task&lt;(IEnumerable&lt;Product&gt; Products, int TotalCount)&gt; GetProductsPagedAsync(
        ProductQueryParameters parameters)
    {
        try
        {
            var products = new List&lt;Product&gt;();
            int totalCount = 0;
            
            using (var connection = new SqlConnection(_connectionString))
            {
                using (var command = new SqlCommand("sp_GetProductsPaged", connection))
                {
                    command.CommandType = CommandType.StoredProcedure;
                    
                    // 住驻转 驻专专
                    command.Parameters.AddWithValue("@PageNumber", parameters.PageNumber);
                    command.Parameters.AddWithValue("@PageSize", parameters.PageSize);
                    command.Parameters.AddWithValue("@SearchTerm", 
                        (object)parameters.SearchTerm ?? DBNull.Value);
                    command.Parameters.AddWithValue("@Category", 
                        (object)parameters.Category ?? DBNull.Value);
                    command.Parameters.AddWithValue("@MinPrice", 
                        parameters.MinPrice.HasValue ? (object)parameters.MinPrice.Value : DBNull.Value);
                    command.Parameters.AddWithValue("@MaxPrice", 
                        parameters.MaxPrice.HasValue ? (object)parameters.MaxPrice.Value : DBNull.Value);
                    command.Parameters.AddWithValue("@SortBy", parameters.SortBy);
                    command.Parameters.AddWithValue("@SortDirection", parameters.SortDirection);
                    
                    // 住驻转 驻专专 驻
                    var totalCountParam = command.Parameters.Add("@TotalCount", SqlDbType.Int);
                    totalCountParam.Direction = ParameterDirection.Output;
                    
                    await connection.OpenAsync();
                    
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        while (await reader.ReadAsync())
                        {
                            products.Add(new Product
                            {
                                Id = reader.GetInt32(reader.GetOrdinal("Id")),
                                Name = reader.GetString(reader.GetOrdinal("Name")),
                                Description = reader.IsDBNull(reader.GetOrdinal("Description")) 
                                    ? null 
                                    : reader.GetString(reader.GetOrdinal("Description")),
                                Price = reader.GetDecimal(reader.GetOrdinal("Price")),
                                Category = reader.GetString(reader.GetOrdinal("Category")),
                                CreatedDate = reader.GetDateTime(reader.GetOrdinal("CreatedDate")),
                                ModifiedDate = reader.IsDBNull(reader.GetOrdinal("ModifiedDate"))
                                    ? (DateTime?)null
                                    : reader.GetDateTime(reader.GetOrdinal("ModifiedDate"))
                            });
                        }
                    }
                    
                    totalCount = (int)totalCountParam.Value;
                }
            }
            
            return (products, totalCount);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 -GetProductsPagedAsync 注 stored procedure");
            throw;
        }
    }
}</code></pre>

            <h3>砖 Redis</h3>
            <pre><code>public class RedisProductRepository : IProductRepository
{
    private readonly IDatabase _redis;
    private readonly ILogger&lt;RedisProductRepository&gt; _logger;
    
    public RedisProductRepository(IConnectionMultiplexer redis, ILogger&lt;RedisProductRepository&gt; logger)
    {
        _redis = redis.GetDatabase();
        _logger = logger;
    }
    
    public async Task&lt;(IEnumerable&lt;Product&gt; Products, int TotalCount)&gt; GetProductsPagedAsync(
        ProductQueryParameters parameters)
    {
        try
        {
            var sortedSetKey = "products:sorted:name";
            
            // 拽转 住驻专 转
            var totalCount = (int)await _redis.SortedSetLengthAsync(sortedSetKey);
            
            // 砖 
            var start = (parameters.PageNumber - 1) * parameters.PageSize;
            var stop = start + parameters.PageSize - 1;
            
            // 拽转  爪专 -sorted set
            var productIds = await _redis.SortedSetRangeByRankAsync(
                sortedSetKey, 
                start, 
                stop);
            
            // 专 驻专 爪专 
            var products = new List&lt;Product&gt;();
            foreach (var productId in productIds)
            {
                var productKey = $"product:{productId}";
                var productJson = await _redis.StringGetAsync(productKey);
                
                if (!productJson.IsNullOrEmpty)
                {
                    var product = System.Text.Json.JsonSerializer.Deserialize&lt;Product&gt;(productJson);
                    products.Add(product);
                }
            }
            
            return (products, totalCount);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "砖 -GetProductsPagedAsync -Redis");
            throw;
        }
    }
}</code></pre>
        </div>

        <div id="advanced" class="section">
            <h2>6. 转专砖 转拽</h2>

            <h3>Cursor-Based Paging</h3>
            <p>Cursor-based paging  注专 驻 砖 转  转 注转 -"page drift" 砖专 转 砖转:</p>

            <pre><code>public class CursorPagingParameters
{
    public int PageSize { get; set; } = 10;
    public string Cursor { get; set; } // Cursor 拽 Base64
}

public class CursorPagedResponse&lt;T&gt;
{
    public IEnumerable&lt;T&gt; Data { get; set; }
    public string NextCursor { get; set; }
    public string PreviousCursor { get; set; }
    public bool HasMore { get; set; }
}

public class ProductCursor
{
    public int Id { get; set; }
    public DateTime CreatedDate { get; set; }
    
    public string Encode()
    {
        var json = System.Text.Json.JsonSerializer.Serialize(this);
        var bytes = System.Text.Encoding.UTF8.GetBytes(json);
        return Convert.ToBase64String(bytes);
    }
    
    public static ProductCursor Decode(string cursor)
    {
        if (string.IsNullOrWhiteSpace(cursor))
            return null;
        
        var bytes = Convert.FromBase64String(cursor);
        var json = System.Text.Encoding.UTF8.GetString(bytes);
        return System.Text.Json.JsonSerializer.Deserialize&lt;ProductCursor&gt;(json);
    }
}

// 砖 Repository
public async Task&lt;CursorPagedResponse&lt;Product&gt;&gt; GetProductsWithCursorAsync(
    CursorPagingParameters parameters)
{
    var cursor = ProductCursor.Decode(parameters.Cursor);
    
    IQueryable&lt;Product&gt; query = _context.Products.AsNoTracking();
    
    if (cursor != null)
    {
        // 拽转 驻专 专 -cursor
        query = query.Where(p => 
            p.CreatedDate < cursor.CreatedDate || 
            (p.CreatedDate == cursor.CreatedDate && p.Id < cursor.Id));
    }
    
    var products = await query
        .OrderByDescending(p => p.CreatedDate)
        .ThenByDescending(p => p.Id)
        .Take(parameters.PageSize + 1)
        .ToListAsync();
    
    var hasMore = products.Count > parameters.PageSize;
    if (hasMore)
    {
        products = products.Take(parameters.PageSize).ToList();
    }
    
    var nextCursor = hasMore && products.Any()
        ? new ProductCursor 
        { 
            Id = products.Last().Id, 
            CreatedDate = products.Last().CreatedDate 
        }.Encode()
        : null;
    
    return new CursorPagedResponse&lt;Product&gt;
    {
        Data = products,
        NextCursor = nextCursor,
        HasMore = hasMore
    };
}</code></pre>

            <h3>Keyset Paging (砖转 Seek)</h3>
            <p>注 转专 注专 注专 转 :</p>

            <pre><code>public class KeysetPagingParameters
{
    public int PageSize { get; set; } = 10;
    public int? LastId { get; set; }
    public DateTime? LastCreatedDate { get; set; }
}

public async Task&lt;(IEnumerable&lt;Product&gt; Products, bool HasMore)&gt; GetProductsWithKeysetAsync(
    KeysetPagingParameters parameters)
{
    IQueryable&lt;Product&gt; query = _context.Products.AsNoTracking();
    
    if (parameters.LastId.HasValue && parameters.LastCreatedDate.HasValue)
    {
        // 转 Keyset 祝 
        query = query.Where(p => 
            p.CreatedDate < parameters.LastCreatedDate.Value || 
            (p.CreatedDate == parameters.LastCreatedDate.Value && p.Id > parameters.LastId.Value));
    }
    
    var products = await query
        .OrderByDescending(p => p.CreatedDate)
        .ThenBy(p => p.Id)
        .Take(parameters.PageSize + 1)
        .ToListAsync();
    
    var hasMore = products.Count > parameters.PageSize;
    if (hasMore)
    {
        products = products.Take(parameters.PageSize).ToList();
    }
    
    return (products, hasMore);
}</code></pre>
        </div>

        <div id="best-practices" class="section">
            <h2>7. 砖转 注 爪转</h2>

            <h3>驻爪 砖 爪注</h3>

            <h4>1. 转 砖转砖 -Indexes</h4>
            <pre><code>-- 爪专转 indexes 注 注转 驻爪转 住 
CREATE NONCLUSTERED INDEX IX_Products_Name 
ON Products(Name);

CREATE NONCLUSTERED INDEX IX_Products_Category_Price 
ON Products(Category, Price);

CREATE NONCLUSTERED INDEX IX_Products_CreatedDate 
ON Products(CreatedDate DESC) INCLUDE (Name, Price);</code></pre>

            <h4>2. 砖转砖 -AsNoTracking 注专 砖转转 拽专 </h4>
            <pre><code>var products = await _context.Products
    .AsNoTracking() // 砖驻专 砖注转转 转 爪注
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();</code></pre>

            <h4>3. 注 注转 N+1 Queries</h4>
            <pre><code>// 专注: 注转 N+1 query
var products = await _context.Products
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();

// : 砖转砖 -eager loading
var products = await _context.Products
    .Include(p => p.Category)
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();</code></pre>

            <h4>4. 砖转砖 -Projection 注专 拽 </h4>
            <pre><code>// 拽 注 entity 砖
var products = await _context.Products
    .Skip(offset)
    .Take(pageSize)
    .Select(p => new ProductDto
    {
        Id = p.Id,
        Name = p.Name,
        Price = p.Price
        // 专拽 专 砖转 砖转 爪专
    })
    .ToListAsync();</code></pre>

            <h3>住专转 Caching</h3>
            <pre><code>public class CachedProductService : IProductService
{
    private readonly IProductService _innerService;
    private readonly IMemoryCache _cache;
    private readonly ILogger&lt;CachedProductService&gt; _logger;
    
    public async Task&lt;PagedResponse&lt;ProductDto&gt;&gt; GetProductsAsync(ProductQueryParameters parameters)
    {
        var cacheKey = $"products_{parameters.PageNumber}_{parameters.PageSize}_" +
                      $"{parameters.SearchTerm}_{parameters.Category}_{parameters.SortBy}";
        
        if (_cache.TryGetValue(cacheKey, out PagedResponse&lt;ProductDto&gt; cachedResult))
        {
            _logger.LogInformation("转 专 -cache: {CacheKey}", cacheKey);
            return cachedResult;
        }
        
        var result = await _innerService.GetProductsAsync(parameters);
        
        var cacheOptions = new MemoryCacheEntryOptions()
            .SetSlidingExpiration(TimeSpan.FromMinutes(5))
            .SetAbsoluteExpiration(TimeSpan.FromMinutes(30));
        
        _cache.Set(cacheKey, result, cacheOptions);
        
        return result;
    }
}</code></pre>

            <h3>转 拽 (Input Validation)</h3>
            <pre><code>public class PagingParametersValidator : AbstractValidator&lt;PagingParameters&gt;
{
    public PagingParametersValidator()
    {
        RuleFor(x => x.PageNumber)
            .GreaterThan(0)
            .WithMessage("住驻专 祝  转  -0");
        
        RuleFor(x => x.PageSize)
            .InclusiveBetween(1, 100)
            .WithMessage(" 祝  转  1 -100");
    }
}</code></pre>

            <h3>砖拽 </h3>

            <h4>注转 SQL Injection</h4>
            <pre><code>// 专注 - 驻注 -SQL injection
var sql = $"SELECT * FROM Products WHERE Name LIKE '%{searchTerm}%'";

//  - parameterized
var products = await _context.Products
    .Where(p => p.Name.Contains(searchTerm))
    .ToListAsync();</code></pre>

            <h4>转 注转 </h4>
            <pre><code>private readonly HashSet&lt;string&gt; _allowedSortColumns = new(StringComparer.OrdinalIgnoreCase)
{
    "Name", "Price", "CreatedDate", "Category"
};

private string ValidateSortColumn(string sortBy)
{
    if (string.IsNullOrWhiteSpace(sortBy) || !_allowedSortColumns.Contains(sortBy))
    {
        return "Name"; // 专专转 
    }
    return sortBy;
}</code></pre>

            <h4>Rate Limiting</h4>
            <pre><code>[EnableRateLimiting("fixed")]
[HttpGet]
public async Task&lt;ActionResult&lt;PagedResponse&lt;ProductDto&gt;&gt;&gt; GetProducts(
    [FromQuery] ProductQueryParameters parameters)
{
    var result = await _productService.GetProductsAsync(parameters);
    return Ok(result);
}

// -Program.cs
builder.Services.AddRateLimiter(options =>
{
    options.AddFixedWindowLimiter("fixed", opt =>
    {
        opt.PermitLimit = 100;
        opt.Window = TimeSpan.FromMinutes(1);
    });
});</code></pre>
        </div>

        <div id="pitfalls" class="section">
            <h2>8. 转 驻爪转</h2>

            <h3>1. 住专 ORDER BY</h3>
            <div class="warning">
                <strong>锔 注:</strong> 转爪转 注砖转 转  注拽转  .
            </div>
            <pre><code>// 专注: 转爪转 注砖转 转  注拽转
var products = await _context.Products
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();

// : 转 爪 
var products = await _context.Products
    .OrderBy(p => p.Id)
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();</code></pre>

            <h3>2. 住驻专 驻 住</h3>
            <pre><code>// 专注: 住驻专 转 砖
var totalCount = await _context.Products.CountAsync();
var products = await _context.Products
    .Where(p => p.Category == "Electronics")
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();

// : 住驻专 专 住
var query = _context.Products.Where(p => p.Category == "Electronics");
var totalCount = await query.CountAsync();
var products = await query
    .Skip(offset)
    .Take(pageSize)
    .ToListAsync();</code></pre>

            <h3>3.  祝 </h3>
            <pre><code>// 注  祝 拽住
public class PagingParameters
{
    private const int MaxPageSize = 100;
    private int _pageSize = 10;
    
    public int PageSize
    {
        get => _pageSize;
        set => _pageSize = value > MaxPageSize ? MaxPageSize : value;
    }
}</code></pre>

            <h3>4. -驻 拽专 拽爪</h3>
            <pre><code>// 驻 住驻专 祝 注专 住 驻
if (parameters.PageNumber > totalPages && totalCount > 0)
{
    return BadRequest($"祝 {parameters.PageNumber} 专 住 驻 {totalPages}");
}

// 驻 转爪转 专拽转 爪专 
if (totalCount == 0)
{
    return Ok(new PagedResponse&lt;ProductDto&gt;(
        new List&lt;ProductDto&gt;(), 
        parameters.PageNumber, 
        parameters.PageSize, 
        0));
}</code></pre>
        </div>

        <div id="summary" class="section">
            <h2>9. 住</h2>

            <h3>拽转 驻转</h3>
            <ol>
                <li><strong>转 砖转砖  注拽</strong> 注转 砖 paging</li>
                <li><strong>转 驻专专 拽</strong> 注转 砖砖 专注 砖转</li>
                <li><strong>注  祝 拽住</strong>  注 砖 砖专转</li>
                <li><strong>砖转砖 -indexes 转</strong> 注 注转 转 住转</li>
                <li><strong>专 转 住专转 -paging </strong> 转专砖 砖:
                    <ul>
                        <li>Offset-based 转专砖 驻砖</li>
                        <li>Cursor-based 驻  转</li>
                        <li>Keyset 注专 转 </li>
                    </ul>
                </li>
                <li><strong>砖专 转爪转 -cache 砖转</strong> 砖驻专 爪注</li>
                <li><strong>驻 拽专 拽爪</strong> 爪专  (转爪转 专拽转, 驻 注专 )</li>
                <li><strong>转注 转 -API 砖</strong> 爪专 专专 注 转</li>
                <li><strong>注拽 专砖</strong> 驻注转 paging 转 爪注</li>
                <li><strong>拽 注 驻 转 专住</strong> 驻 注 爪专</li>
            </ol>

            <h3> 拽专转 API</h3>
            <pre><code>GET /api/products?pageNumber=2&pageSize=20&searchTerm=laptop&category=Electronics
&minPrice=500&maxPrice=2000&sortBy=price&sortDirection=desc</code></pre>

            <h3> 转</h3>
            <pre><code>{
  "pageNumber": 2,
  "pageSize": 20,
  "totalCount": 156,
  "totalPages": 8,
  "hasPrevious": true,
  "hasNext": true,
  "data": [
    {
      "id": 101,
      "name": "Gaming Laptop Pro",
      "description": "High-performance gaming laptop",
      "price": 1899.99,
      "category": "Electronics",
      "createdDate": "2024-01-15T10:30:00Z"
    }
    // ... 驻专 住驻
  ]
}</code></pre>

            <div class="tip">
                <strong> 砖 住驻:</strong>
                <ul>
                    <li><a href="https://docs.microsoft.com/en-us/ef/core/" target="_blank">转注 Entity Framework Core</a></li>
                    <li><a href="https://docs.microsoft.com/en-us/aspnet/core/web-api/" target="_blank">砖转 注 爪转 ASP.NET Core Web API</a></li>
                    <li><a href="https://docs.microsoft.com/en-us/sql/t-sql/queries/select-order-by-clause-transact-sql" target="_blank">拽转 Paging -SQL Server</a></li>
                    <li><a href="https://restfulapi.net/" target="_blank">转 注爪 RESTful API</a></li>
                </ul>
            </div>
        </div>

        <div style="margin-top: 60px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #666;">
            <p><strong>专住转 住:</strong> 1.0 | <strong>注 专:</strong> 专 2026</p>
            <p><strong>转拽 注 :</strong> 爪转 驻转</p>
        </div>
    </div>
</body>
</html>